rule  Dev_sigma_suspicious_new_printer_ports_in_registry_cve20201048 {
 meta:
    author = "EagleEye Team, Florian Roth, NVISO"
    description = "Detects a new and suspicious printer port creation in Registry that could be an attempt to exploit CVE-2020-1048 Author: EagleEye Team, Florian Roth, NVISO."
    reference = ""
    version = "0.01"
    created = "2020/05/13"
    product = "windows"
    category = "registry_event"
    mitre = "persistence, execution, defense_evasion, t1112"

  events:
(re.regex($selection.target.registry.registry_key, `HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Ports.*`) and (re.regex($selection.metadata.description, `.*\.dll.*`) or re.regex($selection.metadata.description, `.*\.exe.*`) or re.regex($selection.metadata.description, `.*\.bat.*`) or re.regex($selection.metadata.description, `.*\.com.*`) or re.regex($selection.metadata.description, `.*C:.*`)))

  condition:
    $selection
}
