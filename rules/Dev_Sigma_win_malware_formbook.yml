rule  Dev_sigma_formbook_process_creation {
 meta:
    author = "Florian Roth, oscd.community, Jonhnathan Ribeiro"
    description = "Detects Formbook like process executions that inject code into a set of files in the System32 folder, which executes a special command command line to delete the dropper from the AppData Temp folder. We avoid false positives by excluding all parent process with command line parameters. Author: Florian Roth, oscd.community, Jonhnathan Ribeiro."
    reference = ""
    version = "0.01"
    created = "2019/09/30"
    category = "process_creation"
    product = "windows"

  events:
((re.regex($selection.src.process.command_line, `C:\\Windows\\System32\\.*`) or re.regex($selection.src.process.command_line, `C:\\Windows\\SysWOW64\\.*`)) and re.regex($selection.src.process.command_line, `.*\.exe`) and re.regex($selection.target.process.command_line, `.*C:\\Users\\.*`) and ((re.regex($selection.target.process.command_line, `.*/c.*`) and re.regex($selection.target.process.command_line, `.*del.*`) and re.regex($selection.target.process.command_line, `.*\\AppData\\Local\\Temp\\.*`)) or (re.regex($selection.target.process.command_line, `.*/c.*`) and re.regex($selection.target.process.command_line, `.*del.*`) and re.regex($selection.target.process.command_line, `.*\\Desktop\\.*`)) or (re.regex($selection.target.process.command_line, `.*/C.*`) and re.regex($selection.target.process.command_line, `.*type nul >.*`) and re.regex($selection.target.process.command_line, `.*\\Desktop\\.*`))) and re.regex($selection.target.process.command_line, `.*\.exe`))

  condition:
    $selection
}
