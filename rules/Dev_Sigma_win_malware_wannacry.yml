rule  Dev_sigma_wannacry_ransomware {
 meta:
    author = "Florian Roth (rule), Tom U. @c_APT_ure (collection), oscd.community, Jonhnathan Ribeiro"
    description = "Detects WannaCry ransomware activity Author: Florian Roth (rule), Tom U. @c_APT_ure (collection), oscd.community, Jonhnathan Ribeiro."
    reference = ""
    version = "0.01"
    created = "2019/01/16"
    category = "process_creation"
    product = "windows"
    mitre = "lateral_movement, t1210, discovery, t1083, defense_evasion, t1222.001, t1222, impact, t1486, t1490"

  events:
((re.regex($selection1.target.process.file.full_path, `.*\\tasksche\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\mssecsvc\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\taskdl\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\taskhsvc\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\taskse\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\111\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\lhdfrgui\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\diskpart\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\linuxnew\.exe`) or re.regex($selection1.target.process.file.full_path, `.*\\wannacry\.exe`)) or re.regex($selection1.target.process.file.full_path, `.*WanaDecryptor.*`) or (re.regex($selection1.target.process.command_line, `.*icacls.*`) and re.regex($selection1.target.process.command_line, `.*/grant.*`) and re.regex($selection1.target.process.command_line, `.*Everyone:F.*`) and re.regex($selection1.target.process.command_line, `.*/T.*`) and re.regex($selection1.target.process.command_line, `.*/C.*`) and re.regex($selection1.target.process.command_line, `.*/Q.*`)) or (re.regex($selection1.target.process.command_line, `.*bcdedit.*`) and re.regex($selection1.target.process.command_line, `.*/set.*`) and re.regex($selection1.target.process.command_line, `.*{default}.*`) and re.regex($selection1.target.process.command_line, `.*recoveryenabled.*`) and re.regex($selection1.target.process.command_line, `.*no.*`)) or (re.regex($selection1.target.process.command_line, `.*wbadmin.*`) and re.regex($selection1.target.process.command_line, `.*delete.*`) and re.regex($selection1.target.process.command_line, `.*catalog.*`) and re.regex($selection1.target.process.command_line, `.*-quiet.*`)) or re.regex($selection1.target.process.command_line, `.*@Please_Read_Me@\.txt.*`))

  condition:
    $selection1
}
