rule  Dev_sigma_suspicious_remote_thread_created {
 meta:
    author = "Perez Diego (@darkquassar), oscd.community"
    description = "Offensive tradecraft is switching away from using APIs like \"CreateRemoteThread\", however, this is still largely observed in the wild. This rule  Dev_sigma_aims to detect suspicious processes (those we would not expect to behave in this way like word.exe or outlook.exe) creating remote threads on other processes. It is a generalistic rule, but it should have a low FP ratio due to the selected range of processes. Author: Perez Diego (@darkquassar), oscd.community."
    reference = ""
    version = "0.01"
    created = "2019/10/27"
    product = "windows"
    category = "create_remote_thread"
    mitre = "privilege_escalation, defense_evasion, t1055"

  events:
((re.regex($selection.src.process.file.full_path, `.*\\bash\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\cvtres\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\defrag\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\dnx\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\esentutl\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\excel\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\expand\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\explorer\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\find\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\findstr\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\forfiles\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\git\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\gpupdate\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\hh\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\iexplore\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\installutil\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\lync\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\makecab\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\mDNSResponder\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\monitoringhost\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\msbuild\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\mshta\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\msiexec\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\mspaint\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\outlook\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\ping\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\powerpnt\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\powershell\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\provtool\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\python\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\regsvr32\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\robocopy\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\runonce\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\sapcimc\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\schtasks\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\smartscreen\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\spoolsv\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\tstheme\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\userinit\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\vssadmin\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\vssvc\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\w3wp\.exe.*`) or re.regex($selection.src.process.file.full_path, `.*\\winlogon\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\winscp\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\wmic\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\word\.exe`) or re.regex($selection.src.process.file.full_path, `.*\\wscript\.exe`)) and not (re.regex($selection.src.process.file.full_path, `.*Visual Studio.*`)))

  condition:
    $selection
}
