rule  Dev_sigma_executable_used_by_plugx_in_uncommon_location {
 meta:
    author = "Florian Roth"
    description = "Detects the execution of an executable that is typically used by PlugX for DLL side loading started from an uncommon location Author: Florian Roth."
    reference = ""
    version = "0.01"
    created = "2017/06/12"
    category = "process_creation"
    product = "windows"
    mitre = "s0013, defense_evasion, t1073, t1574.002"

  events:
((((((((((((re.regex($selection_cammute.target.process.file.full_path, `.*\\CamMute\.exe`) and not ((re.regex($selection_cammute.target.process.file.full_path, `.*\\Lenovo\\Communication Utility\\.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\Lenovo\\Communications Utility\\.*`)))) or (re.regex($selection_cammute.target.process.file.full_path, `.*\\chrome_frame_helper\.exe`) and not (re.regex($selection_cammute.target.process.file.full_path, `.*\\Google\\Chrome\\application\\.*`)))) or (re.regex($selection_cammute.target.process.file.full_path, `.*\\dvcemumanager\.exe`) and not (re.regex($selection_cammute.target.process.file.full_path, `.*\\Microsoft Device Emulator\\.*`)))) or (re.regex($selection_cammute.target.process.file.full_path, `.*\\Gadget\.exe`) and not (re.regex($selection_cammute.target.process.file.full_path, `.*\\Windows Media Player\\.*`)))) or (re.regex($selection_cammute.target.process.file.full_path, `.*\\hcc\.exe`) and not (re.regex($selection_cammute.target.process.file.full_path, `.*\\HTML Help Workshop\\.*`)))) or (re.regex($selection_cammute.target.process.file.full_path, `.*\\hkcmd\.exe`) and not ((re.regex($selection_cammute.target.process.file.full_path, `.*\\System32\\.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\SysNative\\.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\SysWowo64\\.*`))))) or (re.regex($selection_cammute.target.process.file.full_path, `.*\\Mc\.exe`) and not ((re.regex($selection_cammute.target.process.file.full_path, `.*\\Microsoft Visual Studio.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\Microsoft SDK.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\Windows Kit.*`))))) or (re.regex($selection_cammute.target.process.file.full_path, `.*\\MsMpEng\.exe`) and not ((re.regex($selection_cammute.target.process.file.full_path, `.*\\Microsoft Security Client\\.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\Windows Defender\\.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\AntiMalware\\.*`))))) or (re.regex($selection_cammute.target.process.file.full_path, `.*\\msseces\.exe`) and not ((re.regex($selection_cammute.target.process.file.full_path, `.*\\Microsoft Security Center\\.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\Microsoft Security Client\\.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\Microsoft Security Essentials\\.*`))))) or (re.regex($selection_cammute.target.process.file.full_path, `.*\\OInfoP11\.exe`) and not (re.regex($selection_cammute.target.process.file.full_path, `.*\\Common Files\\Microsoft Shared\\.*`)))) or (re.regex($selection_cammute.target.process.file.full_path, `.*\\OleView\.exe`) and not ((re.regex($selection_cammute.target.process.file.full_path, `.*\\Microsoft Visual Studio.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\Microsoft SDK.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\Windows Kit.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\Windows Resource Kit\\.*`))))) or (re.regex($selection_cammute.target.process.file.full_path, `.*\\rc\.exe`) and not ((re.regex($selection_cammute.target.process.file.full_path, `.*\\Microsoft Visual Studio.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\Microsoft SDK.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\Windows Kit.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\Windows Resource Kit\\.*`) or re.regex($selection_cammute.target.process.file.full_path, `.*\\Microsoft\.NET\\.*`)))))

  condition:
    $selection_cammute
}
